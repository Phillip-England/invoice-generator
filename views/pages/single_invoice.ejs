<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%=invoice.name%></title>
    <%- include('../partials/styles.ejs') %>
</head>
<body NODE_ENV="<%=NODE_ENV%>" page="single_invoice_page" >
    
    <div id="grid-main-single-invoice">

        <%- include('../partials/navbar.ejs') %>

        <section id="wrapper-header-single-invoice" class="margin-bottom-md position-relative">
            <div id="grid-header-single-invoice" class="position-relative bg-color-gray box-shadow-bottom">
                <div class="flex-row-center-align padding-sm">
                    <h1 class="header-title font-family-primary font-size-lg color-main"><%=invoice.name%></h1>
                </div>
                <div class="flex-row-center-align padding-sm">
                    <h1 class="header-date font-family-primary font-size-lg color-main"><%=invoice.date%></h1>
                </div>
                <div class="flex-column-center-align padding-sm">
                    <button id="menu-main-button" class="header-button border-main-color border-radius-sharp padding-xxs position-relative flex-row-center-align" onmouseenter="toggle.dropDownMenu('menu-main', 'block')" onmouseleave="toggle.dropDownMenu('menu-main', 'none')">
                        <h1 id="menu-main-text" class="font-family-primary font-size-lg color-main">Actions</h1>
                        <i id="menu-main-icon" class="fa-solid fa-caret-down padding-left-xs color-main"></i>
                        <div id="menu-main" class="position-absolute position-top-105 width-100 bg-color-white border-radius-sharp box-shadow-main display-none">
                            <p class="font-family-secondary font-size-lg border-bottom-gray text-align-left border-radius-sharp padding-left-xs color-main hover-bg-color-gray">Save</p>
                            <p class="font-family-secondary font-size-lg border-bottom-gray text-align-left border-radius-sharp padding-left-xs color-main hover-bg-color-gray">Delete</p>
                        </div>   
                    </button>
                </div>
            </div>
        </section>

        <section id="wrapper-header-mobile-single-invoice" class="flex-row-center-align margin-bottom-md margin-sides-md">
            <div id="grid-header-mobile-single-invoice" class="padding-sm border-radius-dull max-width-phone-size width-100 border-top-main-color box-shadow-main">
                <h1 class="header-mobile-title font-size-xl font-family-primary"><%=invoice.name%></h1>
                <p class="header-mobile-invoice-date font-size-lg font-family-secondary"><%=invoice.date%></p>
                <p class="header-mobile-invoice-description font-size-lg font-family-secondary"><%=invoice.description%></p>
                <div class="header-mobile-invoice-cost flex-row-end-align">
                    <h1 id="invoice-cost" class="font-size-lg font-family-primary">$<%=invoice.cost%></h1>
                </div>
                <div class="header-mobile-invoice-print-button flex-row-end-align">
                    <a href=<%=`/invoice/generateInvoicePdf/${invoice._id}`%>>
                        <i class="fa-solid fa-print fa-lg hover-color-main"></i>
                    </a>
                </div>   
                <button id="expense_delete_button" style="display:none;" onclick="deleteExpenses(this, '<%=NODE_ENV%>')">
                    <i class="fa-solid fa-trash-can fa-xl hover-color-red"></i>    
                </button>   
            </div>
             
        </section>

        <section id="wrapper-form-add-expense-single-invoice" class="flex-row-center-align margin-bottom-md margin-sides-md">
            <form id="grid-form-add-expense-single-invoice" class="padding-sm border-radius-dull max-width-phone-size width-100 border-top-main-color box-shadow-main" onsubmit="event.preventDefault(), jsForm.postForm(this, '<%=`/expense/addExpense/${user._id}/${invoice._id}`%>')">
                <h1 class="font-size-xl font-family-primary margin-bottom-xs">Add an Expense</h1>
                <label class="font-size-md font-family-primary" for="expense_date">Date<span>*</span></label>
                <input class="font-size-lg font-family-secondary margin-bottom-xs border-radius-sharp border-black-sm border-focus-main-color" type="text" name="expense_date" placeholder="01/01/2022">
                <label class="font-size-md font-family-primary" for="expense_vendor">Vendor<span>*</span></label>
                <select class="font-size-lg font-family-secondary margin-bottom-xs border-radius-sharp border-black-sm border-focus-main-color" name="expense_vendor" id="expense_vendor">
                    <option value=""></option>
                    <% vendors.forEach(vendor => { %>
                        <option value="<%=vendor.name%>"><%=vendor.name%></option>
                    <% }) %>
                </select>
                <label class="font-size-md font-family-primary" for="expense_category">Category<span>*</span></label>
                <select class="font-size-lg font-family-secondary margin-bottom-xs border-radius-sharp border-black-sm border-focus-main-color" name="expense_category" id="expense_category">
                    <option value=""></option>
                    <% categories.forEach(category => { %>
                        <option value="<%=category.name%>"><%=category.name%></option>
                    <% }) %>
                </select>    
                <label class="font-size-md font-family-primary" for="expense_description">Description<span>*</span></label>
                <input class="font-size-lg font-family-secondary margin-bottom-xs border-radius-sharp border-black-sm border-focus-main-color" type="text" name="expense_description">
                <label class="font-size-md font-family-primary" for="expense_cost">Cost<span>*</span></label>
                <input class="font-size-lg font-family-secondary margin-bottom-xs border-radius-sharp border-black-sm border-focus-main-color" type="text" name="expense_cost">
                <div class="flex-row-center-align">
                    <button class="bg-color-main flex-row-center-align width-33 border-radius-sharp border-black-sm hover-bg-color-black hover-color-main hover-border-main" type="submit">
                        <h1 class="font-size-lg font-family-primary width-100">
                            Add
                            <i class="fa-solid fa-money-check padding-left-sm"></i>
                        </h1>
                    </button>
                    <div name="loading-icon" class="loading_icon"></div>
                </div>
            </form>
        </section>


        <% if (expenses.length > 0) { %>
            <section id="wrapper-expenses-single-invoice" class="flex-column-center-align">
                <form action="">
                    <table class="border-collapse border-spacing-0 box-shadow-main border-radius-top-dull color-even-rows-gray">
                        <thead class="bg-color-main">
                            <tr>
                                <th class="text-align-left font-family-primary font-size-md border-radius-top-left-dull padding-xs color-white width-50-px"></th>
                                <th class="column-date text-align-left font-family-primary font-size-md padding-xs color-white">Date</th>
                                <th class="column-invoice text-align-left font-family-primary font-size-md padding-xs color-white">Invoice</th>
                                <th class="column-vendor text-align-left font-family-primary font-size-md padding-xs color-white">Vendor</th>
                                <th class="column-category text-align-left font-family-primary font-size-md padding-xs color-white">Category</th>
                                <th class="column-description text-align-left font-family-primary font-size-md padding-xs color-white">Description</th>
                                <th class="column-cost text-align-left font-family-primary font-size-md border-radius-top-right-dull padding-xs color-white">Cost</th>
                            </tr>    
                        </thead>
                        <% expenses.forEach(expense => { %>
                            <tr>
                                <td>
                                    <div class="flex-row-center-align">
                                        <input type="checkbox" class="checkbox-expense-item" onclick="toggle.cssStyle(jsTable.hasCheckedCheckboxes('checkbox-expense-item'), {
                                            element1: {
                                                target: [document.getElementById('menu-main-button')],
                                                attribute: 'style',
                                                style: ['background-color', 'border'],
                                                value: ['var(--main-color)', 'solid white 1px'],
                                                defaultValue: ['white', 'solid var(--main-color), 1px'],
                                            },
                                            element2: {
                                                target: [document.getElementById('menu-main-text'), document.getElementById('menu-main-icon')],
                                                attribute: 'style',
                                                style: ['color'],
                                                value: ['white'],
                                                defaultValue: ['var(--main-color)'],
                                            }
                                        })">
                                    </div>
                                </td>
                                <td>
                                    <input class="input-shrink column-date font-family-secondary font-size-md" value="<%=expense.date%>"></input>
                                </td>
                                <td>
                                    <select class="input-shrink column-invoice font-family-secondary font-size-md" name="expense_invoice">
                                        <option value="<%=invoice.name%>"><%=invoice.name%></option>
                                        <% invoices.forEach(inv => { %>
                                            <!-- omit the current category from the lisitng -->
                                            <%if (inv.name != invoice.name) { %>
                                                <option value="<%=inv.name%>"><%=inv.name%></option>
                                            <% } %>
                                        <% }) %>
                                    </select>
                                </td>
                                <td>
                                    <select class="input-shrink column-vendor font-family-secondary font-size-md" name="expense_vendor">
                                        <option value="<%=expense.vendor%>"><%=expense.vendor%></option>
                                        <% vendors.forEach(vendor => { %>
                                            <!-- omit the current category from the lisitng -->
                                            <%if (expense.vendor != vendor.name) { %>
                                                <option value="<%=vendor.name%>"><%=vendor.name%></option>
                                            <% } %>
                                        <% }) %>
                                    </select>
                                </td>
                                <td>
                                    <select class="input-shrink column-category font-family-secondary font-size-md" name="expense_category">
                                        <option value="<%=expense.category%>"><%=expense.category%></option>
                                        <% categories.forEach(category => { %>
                                            <!-- omit the current category from the lisitng -->
                                            <%if (expense.category != category.name) { %>
                                                <option value="<%=category.name%>"><%=category.name%></option>
                                            <% } %>
                                        <% }) %>
                                    </select>
                                </td>
                                <td>
                                    <input class="input-shrink column-description font-family-secondary font-size-md" value="<%=expense.description%>"></input>
                                </td>
                                <td>
                                    <input class="input-shrink column-cost font-family-secondary font-size-md" value="<%=expense.cost%>"></input>
                                </td>
                            </tr>
                        <% }) %>
                    </table>
                </form>
            </section>
        <% } %>

        
        <section id="wrapper-expenses-mobile-single-invoice" class="flex-column-center-align margin-bottom-md margin-sides-md">
            <% expenses.forEach(expense => { %>
                <div class="grid-expense-mobile-information max-width-phone-size width-100 padding-sm border-radius-dull border-top-main-color box-shadow-main margin-bottom-md">
                    <h1 class="expense-mobile-date font-size-xl font-family-primary"><%=expense.date%></h1>
                    <div class="expense-mobile-icon flex-row-end-align">
                        <i class="fa-solid fa-pencil hover-color-main" onclick="toggle.hideAndShowByClassName({
                            style: 'grid',
                            showClassName: 'grid-expense-mobile-information',
                            hideClassName: 'grid-expense-mobile-update-form',
                        }), toggle.swap({
                            display: 'grid',
                            element1: this.parentElement.parentElement,
                            element2: this.parentElement.parentElement.nextElementSibling,
                        })"></i>
                    </div>
                    <div class="expense-mobile-icon flex-row-end-align display-none">
                        <i class="fa-solid fa-trash-can hover-color-red" onclick="jsFetch.deleteAndRemove({
                            url: '<%=`/expense/deleteExpense/${expense._id}`%>',
                            elements: {
                                element1: this.parentElement.parentElement,
                                element2: this.parentElement.parentElement.nextElementSibling
                            },
                            parent: this.parentElement.parentElement.parentElement,
                        })"></i>
                    </div>
                    <p class="expense-mobile-vendor font-size-md font-family-primary"><%=expense.vendor%></p>
                    <div class="expense-mobile-delete flex-row-end-align">
                        <p class="font-size-md font-family-primary">Delete</p>
                        <input type="checkbox" class="margin-left-xxs" onclick="toggle.swap({
                            display: 'flex',
                            element1: this.parentElement.previousElementSibling.previousElementSibling.previousElementSibling,
                            element2: this.parentElement.previousElementSibling.previousElementSibling,
                        })">
                    </div>
                    <p class="expense-mobile-cost font-size-md font-family-primary">$<%=expense.cost%></p>
                    <div class="expense-mobile-complete flex-row-end-align">
                        <p class="font-size-md font-family-primary">Complete</p>
                        <% if (expense.completed == true) { %>
                            <input class="margin-left-xxs" type="checkbox" checked onclick="jsFetch.putAndRender({
                                url: '<%=`/expense/completeExpense/${invoice._id}/${expense._id}`%>',
                                renderTarget: document.getElementById('invoice-cost'),
                            })">
                        <% } else { %>
                            <input class="margin-left-xxs" type="checkbox" onclick="jsFetch.putAndRender({
                                url: '<%=`/expense/completeExpense/${invoice._id}/${expense._id}`%>',
                                renderTarget: document.getElementById('invoice-cost'),
                            })">
                        <% } %>
                    </div>
                </div>
                <form class="grid-expense-mobile-update-form max-width-phone-size width-100 padding-sm border-radius-dull border-top-main-color box-shadow-main display-none" onsubmit="event.preventDefault(), jsForm.postForm(this, '<%=`/expense/updateExpense/${invoice._id}/${expense._id}`%>')">
                    <h1 class="font-size-xl font-family-primary margin-bottom-xs">Update Expense</h1>
                    <div class="expense-mobile-close flex-row-end-align margin-bottom-xs">
                        <i class="fa-solid fa-x hover-color-red" onclick="toggle.swap({
                            display: 'grid',
                            element1: this.parentElement.parentElement,
                            element2: this.parentElement.parentElement.previousElementSibling
                        })"></i>
                    </div>
                    <label for="expense_date" class="expense-mobile-label-date font-size-md font-family-primary">Date</label>
                    <input type="text" name="expense_date" class="expense-mobile-input-date margin-bottom-xs border-radius-sharp border-black-sm border-focus-main-color width-100 font-size-lg font-family-secondary" value="<%=expense.date%>">
                    <label for="expense_invoice" class="expense-mobile-label-invoice font-size-md font-family-primary">Invoice</label>
                    <select name="expense_invoice" class="expense-mobile-input-invoice margin-bottom-xs border-radius-sharp border-black-sm border-focus-main-color width-100 font-size-lg font-family-secondary" name="expense_vendor">
                        <option value="<%=invoice.name%>"><%=invoice.name%></option>
                        <% invoices.forEach(inv => { %>
                            <!-- omit the current category from the lisitng -->
                            <%if (invoice.name != inv.name) { %>
                                <option value="<%=inv.name%>"><%=inv.name%></option>
                            <% } %>
                        <% }) %>
                    </select>
                    <label for="expense_vendor" class="expense-mobile-label-vendor font-size-md font-family-primary">Vendor</label>
                    <select name="expense_vendor" class="expense-mobile-input-vendor margin-bottom-xs border-radius-sharp border-black-sm border-focus-main-color width-100 font-size-lg font-family-secondary" name="expense_vendor">
                        <option value="<%=expense.vendor%>"><%=expense.vendor%></option>
                        <% vendors.forEach(vendor => { %>
                            <!-- omit the current category from the lisitng -->
                            <%if (expense.vendor != vendor.name) { %>
                                <option value="<%=vendor.name%>"><%=vendor.name%></option>
                            <% } %>
                        <% }) %>
                    </select>
                    <label for="expense_category" class="expense-mobile-label-category font-size-md font-family-primary">Category</label>
                    <select name="expense_category" class="expense-mobile-input-category margin-bottom-xs border-radius-sharp border-black-sm border-focus-main-color width-100 font-size-lg font-family-secondary" name="expense_vendor">
                        <option value="<%=expense.category%>"><%=expense.category%></option>
                        <% categories.forEach(category => { %>
                            <!-- omit the current category from the lisitng -->
                            <%if (expense.category != category.name) { %>
                                <option value="<%=category.name%>"><%=category.name%></option>
                            <% } %>
                        <% }) %>
                    </select>
                    <label for="expense_description" class="expense-mobile-label-description font-size-md font-family-primary">Description</label>
                    <input name="expense_description" type="text" class="expense-mobile-input-description margin-bottom-xs border-radius-sharp border-black-sm border-focus-main-color width-100 font-size-lg font-family-secondary" value="<%=expense.description%>">
                    <label for="expense_cost" class="expense-mobile-label-cost font-size-md font-family-primary">Cost</label>
                    <input name="expense_cost" type="text" class="expense-mobile-input-cost margin-bottom-xs border-radius-sharp border-black-sm border-focus-main-color width-100 font-size-lg font-family-secondary" value="<%=expense.cost%>">
                    <div class="expense-mobile-submit-button flex-row-center-align">
                        <button class="bg-color-main flex-row-center-align width-33 border-radius-sharp border-black-sm hover-bg-color-black hover-color-main hover-border-main" type="submit">
                            <h1 class="font-size-lg font-family-primary width-100">
                                Update
                                <i class="fa-solid fa-file-pen padding-left-sm"></i>
                            </h1>
                        </button>
                        <div name="loading-icon" class="loading_icon"></div>
                    </div>
                </form>
            <% }) %>
        </section>

        <footer id="single_invoice_footer">

        </footer>

    </div>

</body>
</html>

<%- include('../partials/scripts.ejs') %>

<script>

    const resizeDom = () => {

        jsDom.shrinkInputsInCell('input-shrink', 2)

        jsDom.resizeColumnToLargest(10, {
            date: document.getElementsByClassName('column-date'),
            invoice: document.getElementsByClassName('column-invoice'),
            vendor: document.getElementsByClassName('column-vendor'),
            category: document.getElementsByClassName('column-category'),
            description: document.getElementsByClassName('column-description'),
            cost: document.getElementsByClassName('column-cost'),
        })

    }

    resizeDom()



    




</script>